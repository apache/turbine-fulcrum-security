<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>SecuritySet.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Fulcrum Security Hibernate Impl</a> &gt; <a href="../index.html" class="el_bundle">fulcrum-security-api</a> &gt; <a href="index.source.html" class="el_package">org.apache.fulcrum.security.util</a> &gt; <span class="el_source">SecuritySet.java</span></div><h1>SecuritySet.java</h1><pre class="source lang-java linenums">package org.apache.fulcrum.security.util;

/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

import java.io.Serializable;
import java.util.Collection;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Map;
import java.util.Set;
import java.util.TreeMap;

import org.apache.commons.lang3.StringUtils;
import org.apache.fulcrum.security.entity.SecurityEntity;

/**
 * This class represents a set of Security Entities. It makes it easy to build a
 * UI. It wraps a TreeSet object to enforce that only relevant methods are
 * available. TreeSet's contain only unique Objects (no duplicates) based on the
 * ID. They may or may not have a name, that depends on the implementation. Want
 * to get away from requiring an ID and a name... Nothing should force Name to
 * be unique in the basic architecture of Fulcrum Security.
 *
 * @author &lt;a href=&quot;mailto:epugh@upstate.com&quot;&gt;Eric Pugh&lt;/a&gt;
 * @author &lt;a href=&quot;mailto:jmcnally@collab.net&quot;&gt;John D. McNally&lt;/a&gt;
 * @author &lt;a href=&quot;mailto:bmclaugh@algx.net&quot;&gt;Brett McLaughlin&lt;/a&gt;
 * @author &lt;a href=&quot;mailto:marco@intermeta.de&quot;&gt;Marco Kn&amp;uuml;ttel&lt;/a&gt;
 * @author &lt;a href=&quot;mailto:hps@intermeta.de&quot;&gt;Henning P. Schmiedehausen&lt;/a&gt;
 * @version $Id$
 */
public abstract class SecuritySet&lt;T extends SecurityEntity&gt; implements Serializable, Set&lt;T&gt;, Iterable&lt;T&gt; {
	/** Serial version */
	private static final long serialVersionUID = 2251987059226422569L;

	/** Map for &quot;name&quot; is &quot;security object&quot; */
<span class="fc" id="L53">	protected Map&lt;String, T&gt; nameMap = null;</span>

	/** Map for &quot;id&quot; is &quot;security object&quot; */
<span class="fc" id="L56">	protected Map&lt;Object, T&gt; idMap = null;</span>

	/**
	 * Constructs an empty Set
	 */
	public SecuritySet() 
<span class="fc" id="L62">	{</span>
<span class="fc" id="L63">		nameMap = new TreeMap&lt;String, T&gt;(String.CASE_INSENSITIVE_ORDER);</span>
<span class="fc" id="L64">		idMap = new TreeMap&lt;Object, T&gt;();</span>
<span class="fc" id="L65">	}</span>

	/**
	 * Returns a set of security objects in this object.
	 *
	 * @return A Set Object
	 *
	 */
	public Set&lt;T&gt; getSet() 
	{
<span class="fc" id="L75">		return new HashSet&lt;T&gt;(idMap.values());</span>
	}

	/**
	 * Returns a set of Names in this Object.
	 *
	 * @return The Set of Names in this Object, backed by the actual data.
	 */
	public Set&lt;String&gt; getNames() 
	{
<span class="nc" id="L85">		return nameMap.keySet();</span>
	}

	/**
	 * Returns a set of Id values in this Object.
	 *
	 * @return The Set of Ids in this Object, backed by the actual data.
	 */
	public Set&lt;Object&gt; getIds() 
	{
<span class="nc" id="L95">		return idMap.keySet();</span>
	}

	/**
	 * Removes all Objects from this Set.
	 */
	@Override
	public void clear() 
	{
<span class="nc" id="L104">		nameMap.clear();</span>
<span class="nc" id="L105">		idMap.clear();</span>
<span class="nc" id="L106">	}</span>

	/**
	 * Searches if an Object with a given name is in the Set
	 *
	 * @param name Name of the Security Object.
	 * @return True if argument matched an Object in this Set; false if no match.
	 */
	public boolean containsName(String name) 
	{
<span class="nc bnc" id="L116" title="All 2 branches missed.">		return StringUtils.isNotEmpty(name) ? nameMap.containsKey(name) : false;</span>
	}

	/**
	 * Searches if an Object with a given Id is in the Set
	 *
	 * @param id Id of the Security Object.
	 * @return True if argument matched an Object in this Set; false if no match.
	 */
	public boolean containsId(Object id) 
	{
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">		return (id == null) ? false : idMap.containsKey(id);</span>
	}

	/**
	 * Returns an Iterator for Objects in this Set.
	 *
	 * @return An iterator for the Set
	 */
	@Override
	public Iterator&lt;T&gt; iterator() 
	{
<span class="fc" id="L138">		return idMap.values().iterator();</span>
	}

	/**
	 * Returns size (cardinality) of this set.
	 *
	 * @return The cardinality of this Set.
	 */
	@Override
	public int size() 
	{
<span class="fc" id="L149">		return idMap.size();</span>
	}

	/**
	 * list of role names in this set
	 *
	 * @return The string representation of this Set.
	 */
	@Override
	public String toString() 
	{
<span class="nc" id="L160">		StringBuilder sbuf = new StringBuilder(12 * size());</span>

<span class="nc bnc" id="L162" title="All 2 branches missed.">		for (Iterator&lt;T&gt; it = iterator(); it.hasNext();) {</span>
<span class="nc" id="L163">			T se = it.next();</span>
<span class="nc" id="L164">			sbuf.append('[');</span>
<span class="nc" id="L165">			sbuf.append(se.getName());</span>
<span class="nc" id="L166">			sbuf.append(&quot; -&gt; &quot;);</span>
<span class="nc" id="L167">			sbuf.append(se.getId());</span>
<span class="nc" id="L168">			sbuf.append(']');</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">			if (it.hasNext()) {</span>
<span class="nc" id="L170">				sbuf.append(&quot;, &quot;);</span>
			}
<span class="nc" id="L172">		}</span>

<span class="nc" id="L174">		return sbuf.toString();</span>
	}

	// methods from Set
	/**
	 * @see java.util.Collection#add(java.lang.Object)
	 */
	@Override
	public boolean add(T o) 
	{
<span class="fc bfc" id="L184" title="All 2 branches covered.">		if (contains(o)) </span>
		{
<span class="fc" id="L186">			return false;</span>
		}

<span class="pc bpc" id="L189" title="1 of 2 branches missed.">		if (o.getId() != null) </span>
		{
<span class="fc" id="L191">			idMap.put(o.getId(), o);</span>
		}
		
<span class="pc bpc" id="L194" title="1 of 2 branches missed.">		if (o.getName() != null) </span>
		{
<span class="fc" id="L196">			nameMap.put(o.getName(), o);</span>
		}

<span class="fc" id="L199">		return true;</span>
	}

	/**
	 * Adds the entities in a Collection to this SecuritySet.
	 *
	 * @param collection A Collection of entities.
	 * @return True if this Set changed as a result; false if no change to this Set
	 *         occurred (this Set already contained all members of the added Set).
	 */
	public boolean add(Collection&lt;? extends T&gt; collection) 
	{
<span class="fc" id="L211">		return addAll(collection);</span>
	}

	@Override
	public boolean addAll(Collection&lt;? extends T&gt; collection) 
	{
<span class="fc" id="L217">		boolean res = false;</span>

<span class="fc bfc" id="L219" title="All 2 branches covered.">		for (T o : collection) </span>
<span class="fc" id="L220">			res |= add(o);</span>

<span class="fc" id="L222">		return res;</span>
	}

	@Override
	public boolean isEmpty() 
	{
<span class="nc" id="L228">		return idMap.isEmpty();</span>
	}

	@Override
	public boolean containsAll(Collection&lt;?&gt; collection) 
	{
<span class="nc bnc" id="L234" title="All 2 branches missed.">		for (Object object : collection) </span>
		{
<span class="nc bnc" id="L236" title="All 2 branches missed.">			if (!contains(object)) </span>
			{
<span class="nc" id="L238">				return false;</span>
			}
<span class="nc" id="L240">		}</span>
<span class="nc" id="L241">		return true;</span>
	}

	@Override
	public boolean removeAll(Collection&lt;?&gt; collection) 
	{
<span class="nc" id="L247">		boolean changed = false;</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">		for (Object object : collection) </span>
		{
<span class="nc" id="L250">			boolean result = remove(object);</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">			if (result) </span>
			{
<span class="nc" id="L253">				changed = true;</span>
			}
<span class="nc" id="L255">		}</span>

<span class="nc" id="L257">		return changed;</span>
	}

	@Override
	public boolean retainAll(Collection&lt;?&gt; collection) 
	{
<span class="nc" id="L263">		throw new RuntimeException(&quot;not implemented&quot;);</span>
	}

	/*
	 * (non-Javadoc)
	 *
	 * @see java.util.Collection#toArray()
	 */
	@Override
	public Object[] toArray() 
	{
<span class="fc" id="L274">		return getSet().toArray();</span>
	}

	/**
	 * Checks whether this SecuritySet contains an entity.
	 *
	 * @param o An entity.
	 * @return True if this Set contains the entity, false otherwise.
	 */
	@Override
	public boolean contains(Object o) 
	{
<span class="pc bpc" id="L286" title="2 of 4 branches missed.">		if (o == null || !(o instanceof SecurityEntity)) </span>
		{
<span class="nc" id="L288">			return false;</span>
		} 
		else 
		{
<span class="fc" id="L292">			return containsId(((SecurityEntity) o).getId());</span>
		}
	}

	/**
	 * Removes an entity from this SecuritySet.
	 *
	 * @param o An entity.
	 * @return True if this Set contained the entity before it was removed.
	 */
	@Override
	public boolean remove(Object o) 
	{
<span class="pc bpc" id="L305" title="1 of 2 branches missed.">		if (o instanceof SecurityEntity) </span>
		{
<span class="fc" id="L307">			boolean res = contains(o);</span>
<span class="fc" id="L308">			idMap.remove(((SecurityEntity) o).getId());</span>
<span class="fc" id="L309">			nameMap.remove(((SecurityEntity) o).getName());</span>
<span class="fc" id="L310">			return res;</span>
		}

<span class="nc" id="L313">		return false;</span>
	}

	/* (non-Javadoc)
	 * @see java.util.Set#toArray(java.lang.Object[])
	 */
	@Override
	public &lt;A&gt; A[] toArray(A[] a) 
	{
<span class="nc" id="L322">		return getSet().toArray(a);</span>
	}

	/**
	 * Returns an entity with the given name, if it is contained in this
	 * SecuritySet.
	 *
	 * @param name Name of entity.
	 * @return entity if argument matched an entity in this Set; null if no match.
	 */
	public T getByName(String name) 
	{
<span class="fc" id="L334">		return nameMap.get(name);</span>
	}

	/**
	 * Returns an entity with the given id, if it is contained in this SecuritySet.
	 *
	 * @param id ID of entity.
	 * @return entity if argument matched an entity in this Set; null if no match.
	 */
	public T getById(Object id) 
	{
<span class="nc" id="L345">		return idMap.get(id);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>