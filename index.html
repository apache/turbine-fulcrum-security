<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from xdocs/index.xml at 21 September 2021
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <meta name="author" content="Eric Pugh" />
    <title>Fulcrum Security &#x2013; Security Component</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.9.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="../../" id="bannerLeft" title="Apache Turbine"><img src="../../images/turbine-project.png"  alt="Apache Turbine"/></a></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 21 September 2021<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.0.1-SNAPSHOT</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="../" title="Fulcrum">Fulcrum</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="../../" title="Turbine">Turbine</a></li>
      <li class="pull-right"><a href="https://www.apache.org" class="externalLink" title="Apache">Apache</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li class="active"><a href="#"><span class="none"></span>Main</a></li>
   <li class="nav-header">Modules</li>
    <li><a href="fulcrum-security-api/index.html" title="Fulcrum Security API"><span class="none"></span>Fulcrum Security API</a></li>
    <li><a href="fulcrum-security-hibernate/index.html" title="Fulcrum Security Hibernate Impl"><span class="none"></span>Fulcrum Security Hibernate Impl</a></li>
    <li><a href="fulcrum-security-memory/index.html" title="Fulcrum Security Memory Impl"><span class="none"></span>Fulcrum Security Memory Impl</a></li>
    <li><a href="fulcrum-security-torque/index.html" title="Fulcrum Security Torque Impl"><span class="none"></span>Fulcrum Security Torque Impl</a></li>
    <li><a href="fulcrum-security-dist/index.html" title="Fulcrum Security Distribution Build"><span class="none"></span>Fulcrum Security Distribution Build</a></li>
   <li class="nav-header">Documentation</li>
    <li><a href="authenticators.html" title="Authenticators"><span class="none"></span>Authenticators</a></li>
    <li><a href="example.html" title="Example"><span class="none"></span>Example</a></li>
    <li><a href="tasks.html" title="Tasks"><span class="none"></span>Tasks</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-down"></span>Project Information</a>
     <ul class="nav nav-list">
      <li><a href="dependency-convergence.html" title="Dependency Convergence"><span class="none"></span>Dependency Convergence</a></li>
      <li><a href="dependency-info.html" title="Dependency Information"><span class="none"></span>Dependency Information</a></li>
      <li><a href="dependency-management.html" title="Dependency Management"><span class="none"></span>Dependency Management</a></li>
      <li><a href="distribution-management.html" title="Distribution Management"><span class="none"></span>Distribution Management</a></li>
      <li class="active"><a href="#"><span class="none"></span>About</a></li>
      <li><a href="issue-management.html" title="Issue Management"><span class="none"></span>Issue Management</a></li>
      <li><a href="licenses.html" title="Licenses"><span class="none"></span>Licenses</a></li>
      <li><a href="mailing-lists.html" title="Mailing Lists"><span class="none"></span>Mailing Lists</a></li>
      <li><a href="modules.html" title="Project Modules"><span class="none"></span>Project Modules</a></li>
      <li><a href="plugin-management.html" title="Plugin Management"><span class="none"></span>Plugin Management</a></li>
      <li><a href="plugins.html" title="Plugins"><span class="none"></span>Plugins</a></li>
      <li><a href="scm.html" title="Source Code Management"><span class="none"></span>Source Code Management</a></li>
      <li><a href="summary.html" title="Summary"><span class="none"></span>Summary</a></li>
      <li><a href="team.html" title="Team"><span class="none"></span>Team</a></li>
     </ul></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
   <li class="nav-header">Apache</li>
    <li><a href="https://www.apache.org/" class="externalLink" title="Apache Website"><span class="none"></span>Apache Website</a></li>
    <li><a href="https://www.apache.org/licenses/" class="externalLink" title="License"><span class="none"></span>License</a></li>
    <li><a href="https://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works"><span class="none"></span>How the ASF works</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship"><span class="none"></span>Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks"><span class="none"></span>Thanks</a></li>
    <li><a href="https://www.apache.org/security/" class="externalLink" title="Security"><span class="none"></span>Security</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >


  

  <section>
<h2><a name="Overview"></a>Overview</h2>
    
<p>
      This component provides a highly flexible security framework  It is based on code from the
      Turbine framework, but has been expanded and can be used in any container compatible
      with the Avalon framework.
    </p>
<ul>
      
<li>Allow pluggability via Avalon components of various entities.</li>
      
<li>Explicit Model interface allows generic entities to be glued together in a custom model very quickly.</li>
      
<li>Provide adapters to various other security systems</li>
      
<li>Solve most common problems in dealing with security</li>
      
<li>Not enforce assumptions about how a security framework should be setup.</li>
    </ul>
    
    <section>
<h3><a name="Matrix"></a>Matrix</h3>
      
<table border="0" class="table table-striped">
        
<tr class="a">
          
<th></th>
<th colspan="2">Basic Model</th>
<th colspan="5">Dynamic Model</th>
<th colspan="5">Turbine Model</th>
        </tr>
        
<tr class="b">
          
<th></th>
<th>User</th>
<th>Group</th>
<th>User</th>
<th>Group</th>
<th>Role</th>
<th>Permission</th>
<th>Delegates</th>
<th>User</th>
<th>Group</th>
<th>Role</th>
<th>Permission</th>
<th>UserGroupRole</th>
        </tr>
        
<tr class="a">
<th>Memory</th>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td></tr>
        
<tr class="b">
<th>Hibernate</th>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td></tr>
        
<tr class="a">
<th>Torque</th>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td></tr>
        
<tr class="b">
<th>NT</th>
<td>X</td>
<td>X</td>
<td>X</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td></tr>
      </table>
    </section>
  </section>

  <section>
<h2><a name="Common_Security_Implementations"></a>Common Security Implementations</h2>
    
<p>
    The two most common models for security are embodied in the &quot;Basic&quot; and &quot;Dynamic&quot; models.  A third model, &quot;Turbine&quot;,
    demonstrates customizing the &quot;Dynamic&quot; model by adding a concept of a global group.
    </p>
    <section>
<h3><a name="Dynamic"></a>Dynamic</h3>
      
<p>
      For lack of a better name, this one is called Dynamic because you can configure all the relationships.
      In it, you have a set of permissions that are related in a many to many relation ship with a set or roles.
      Those roles are related
      in a many to many relationship with a set of groups.  A user is in a many to many relationship
      with a set of groups.
      </p>
      
<p>
      The <code>memory</code>, <code>hibernate</code> and <code>torque</code> packages currently implement this security model.
      </p>
    </section>

    <section>
<h3><a name="Turbine"></a>Turbine</h3>
      
<p>
      This model is based on what the Turbine application server uses, and leverages the Dynamic model.  It merely adds
      the concept of a &quot;global group&quot; which is a toplevel group to the Dynamic model (which allows user - role assignments with or without a group).
      However, what makes this different is that instead of roles
      being related just to groups, there instead is a many to many relationship between users and
      groups and roles.  So you pick a user, pick their role, and their group, and that is their permissions.  </p> 
<p>Put it in another way, a simple example would be that a user has just a (global) role assigned (global group) and only optionally is assigned to a group. This allows to have flexible groups assignments and even cascaded security controls: check user's (global) role (this is the default)  - no group assignment required; check group assignment(s); check role assignment of each (non global) group. Permissions are handled like in dynamic model and are as non global group role assignments optional.
      </p>
      
<p>
      The <code>memory</code>, <code>hibernate</code> and <code>torque</code> packages currently implement this security model.
      </p>
    </section>

    <section>
<h3><a name="Basic"></a>Basic</h3>
      
<p>
      This model is very simple and was originally inspired by OSUser's security model.  In it, you have users, and groups, and security
      is based on a user belonging to a group.  Users can belong to multiple groups.  So groups become
      the equivalent of roles/permissions.
      </p>
      
<p>
      The <code>memory</code>, <code>nt</code> <code>torque</code> and <code>hibernate</code>  packages currently implement this security model.
      </p>
    </section>
    
    <section>
<h3><a name="Diagrams"></a>Diagrams</h3>
      
<table border="0" class="table table-striped">
        
<tr class="a" style="background-color: white;">
          
<td><img src="images/dynamic.png" alt="" /></td>
          
<td><img src="images/turbine.png" alt="" /></td>
          
<td><img src="images/basic.png" alt="" /></td>
        </tr>
      </table>
    </section>
  </section>

<section>
<h2><a name="Simple"></a>Simple</h2>

    <section>
<h3><a name="Usage_of_InMemory_components"></a>Usage of InMemory components</h3>
    
<p>
    The InMemory components implement the Basic model.  All data is strictly in memory, and is
    not persisted.  Therefore when your application stops, all values are lost.  However, this is
    very useful in unit testing and prototyping using the Security component.  Notice how role,
    user, group, and permission managers are all Avalon components as well?  This allows you to swap one
    component out for another.  Say you wanted to provide your own group manager that checked that
    a group existed in NT.  You could swap out the MemoryGroupManager implementation for a NTGroupManager,
    assuming you kept the API the same.
    </p>
    </section>
    <section>
<h3><a name="Configuration"></a>Configuration</h3>
    
<p>
    This uses the integrated role and component config XML.  Check the /src/test directory for the most up-to-date
    examples of the configuration files used in unit testing!
    </p>
    
<p>
</p>
<div class="source"><pre class="prettyprint">

&lt;my-system&gt;
  &lt;component
    role=&quot;org.apache.fulcrum.security.SecurityService&quot;
    class=&quot;org.apache.fulcrum.security.BaseSecurityService&quot;&gt;
  &lt;/component&gt;

  &lt;component
    role=&quot;org.apache.fulcrum.security.UserManager&quot;
    class=&quot;org.apache.fulcrum.security.memory.MemoryUserManagerImpl&quot;&gt;
  &lt;/component&gt;
  &lt;component
    role=&quot;org.apache.fulcrum.security.GroupManager&quot;
    class=&quot;org.apache.fulcrum.security.memory.MemoryGroupManagerImpl&quot;&gt;
  &lt;/component&gt;

  &lt;component
    role=&quot;org.apache.fulcrum.security.RoleManager&quot;
    class=&quot;org.apache.fulcrum.security.memory.MemoryRoleManagerImpl&quot;&gt;
  &lt;/component&gt;

  &lt;component
    role=&quot;org.apache.fulcrum.security.PermissionManager&quot;
    class=&quot;org.apache.fulcrum.security.memory.MemoryPermissionManagerImpl&quot;&gt;
  &lt;/component&gt;

  &lt;component
    role=&quot;org.apache.fulcrum.security.ModelManager&quot;
    class=&quot;org.apache.fulcrum.security.memory.basic.MemoryModelManagerImpl&quot;&gt;
  &lt;/component&gt;
&lt;/my-system&gt;

</pre></div>
    
    </section>

  </section>

<section>
<h2><a name="Adapters"></a>Adapters</h2>
  <section>
<h3><a name="Turbine"></a>Turbine</h3>
    
<p>
    For Turbine 4.x or above use the common Security Turbine. 
    </p>
<p>In <code>org.apache.fulcrum.security.adapter.turbine</code> is an implementation of the Turbine Security Service.
    This is designed to allow you to run the Fulcrum Security Service, but have Turbine 2.3's be able to query, through
    the adapter the Fulcrum Security service.
    </p>
    </section>

  <section>
<h3><a name="OSUser"></a>OSUser</h3>
    
<p>
    In <code>org.apache.fulcrum.security.adapter.osuser</code> is an implementation of the various *Provider classes
    required by OSUser.  In order to have OSUser load up these classes, you must add this to your <code>ouser.xml</code> configuration
    file.
    </p>
   
<p>
</p>
<div class="source"><pre class="prettyprint">

    &lt;!-- Fulcrum providers --&gt;
    &lt;provider class=&quot;org.apache.fulcrum.security.adapter.osuser.FulcrumAccessProvider&quot;/&gt;
    &lt;provider class=&quot;org.apache.fulcrum.security.adapter.osuser.FulcrumCredentialsProvider&quot;/&gt;
  &lt;!-- don't have a propertyset provider, so just return a memory one. --&gt;
    &lt;provider class=&quot;com.opensymphony.user.provider.memory.MemoryProfileProvider&quot; /&gt;

</pre></div>
    
    
<p>
      When using the FulcrumAccessProvider and FulcrumCredentialsProvider, you must first pass into them the
      Fulcrum SecurityService class.  They both inherit from BaseFulcrumProvider, so you can just do
      <code>BaseFulcrumProvider.setSecurityService(securityService)</code> before OSUser calls them for the
      first time.
    </p>
    </section>
</section>

<section>
<h2><a name="Implementation_Details"></a>Implementation Details</h2>
  <section>
<h3><a name="Hibernate"></a>Hibernate</h3>
    
<p>
    With the Hibernate SPI, you can just subclass the BasicUserImpl/DynamicUserImpl class, or implement the User interface, provide your own mapping .hbm file
    and then any additional user properties will be persisted!  Very easy customization for your environment!
    </p>
  </section>
  <section>
<h3><a name="Torque"></a>Torque</h3>
    
<p>
    The Torque SPI provides four different (basic, dynamic type and two turbine schemata) schema mappings for the different security models (in the schema directory). You can easily adjust these to your
    needs. If adjustments are needed, set up the <code>project.properties</code> file according to your database environment (see the
    <a class="externalLink" href="http://db.apache.org/torque/torque-4.0/documentation/modules/maven-plugin/index.html">Torque 4.x Maven Plugin Documentation</a> for reference) and use Maven to
    generate the Torque-OM-classes and to re-built the JAR.
    </p>
    </section><section>
<h3><a name="Torque_Dynamic_Model"></a>Torque Dynamic Model</h3>
    
<p>
    The component configuration must refer to the correct Torque-OM-classes as in the following example for the Dynamic model:
    </p>
<div class="source"><pre class="prettyprint">

    &lt;userManager&gt;
        &lt;className&gt;org.apache.fulcrum.security.torque.om.TorqueDynamicUser&lt;/className&gt;
    &lt;/userManager&gt;
    &lt;groupManager&gt;
        &lt;className&gt;org.apache.fulcrum.security.torque.om.TorqueDynamicGroup&lt;/className&gt;
    &lt;/groupManager&gt;
    &lt;roleManager&gt;
        &lt;className&gt;org.apache.fulcrum.security.torque.om.TorqueDynamicRole&lt;/className&gt;
    &lt;/roleManager&gt;
    &lt;permissionManager&gt;
        &lt;className&gt;org.apache.fulcrum.security.torque.om.TorqueDynamicPermission&lt;/className&gt;
    &lt;/permissionManager&gt;

    </pre></div>
    
    </section>
    
<p>
    As a default, the Torque Security Service uses <code>fulcrum</code> as the name of the connection pool for the tables used. This should be considered
    in the Torque configuration when the service is deployed. 
    Another mapping <code>default</code> is provided for the Turbine models. 
    
    Additionally Torque-OM peer classes could be made configurable by using a <a class="externalLink" href="http://turbine.apache.org/fulcrum/fulcrum-security/apidocs/org/apache/fulcrum/security/torque/peer/TorqueTurbinePeer.html">(marker) interface</a>. 
    This is supported out of the box in schema configuration <a class="externalLink" href="http://db.apache.org/torque">Torque 5.0</a> release. 
    
    Before class annotation had to be done manually, check examples in <a class="externalLink" href="http://svn.apache.org/repos/asf/turbine/fulcrum/trunk/security/torque/src/test/">Fulcrum Security Torque</a>!
    and for background cft. <a class="externalLink" href="https://issues.apache.org/jira/browse/TORQUE-309">Torque-309</a>.
    </p>
    
     <section>
<h3><a name="Torque_Turbine_Model"></a>Torque Turbine Model</h3>
      
<p>
      The Turbine model may be as simple as the Dynamic Model, but this is the most expanded configuration: 
      </p>
<div class="source"><pre class="prettyprint">
  
      &lt;userManager&gt;
          &lt;className&gt;org.apache.fulcrum.security.torque.om.TurbineUser&lt;/className&gt;
          &lt;peerClassName&gt;org.apache.fulcrum.security.torque.om.TurbineUserPeerImpl&lt;/peerClassName&gt;
          &lt;!--  required for acl custom mapping --&gt;
          &lt;userGroupRoleManager&gt;
              &lt;peerClassName&gt;org.apache.fulcrum.security.torque.om.TurbineUserGroupRolePeerImpl&lt;/peerClassName&gt;
            &lt;/userGroupRoleManager&gt;
      &lt;/userManager&gt;
      &lt;groupManager lazy=&quot;true&quot;&gt;
          &lt;className&gt;org.apache.fulcrum.security.torque.om.TurbineGroup&lt;/className&gt;
          &lt;peerClassName&gt;org.apache.fulcrum.security.torque.om.TurbineGroupPeerImpl&lt;/peerClassName&gt;
      &lt;/groupManager&gt;
      &lt;roleManager lazy=&quot;true&quot;&gt;
          &lt;className&gt;org.apache.fulcrum.security.torque.om.TurbineRole&lt;/className&gt;
          &lt;peerClassName&gt;org.apache.fulcrum.security.torque.om.TurbineRolePeerImpl&lt;/peerClassName&gt;
      &lt;/roleManager&gt;
      &lt;permissionManager&gt;
          &lt;className&gt;org.apache.fulcrum.security.torque.om.TurbinePermission&lt;/className&gt;
          &lt;peerClassName&gt;org.apache.fulcrum.security.torque.om.TurbinePermissionPeerImpl&lt;/peerClassName&gt;
      &lt;/permissionManager&gt;
  
      </pre></div>
       All managers now show custom peer classes and the <code>userManager</code> has sub-element <code>userGroupRoleManager</code> to get the ACM (Access Control List) with correct (custom) relationships. Additionally the attribute <code>lazy</code> may be set for <code>groupManager</code> and <code>roleManager</code>, which indicates retrieval of dependent relationships occurs only if explicitely requested.
      
     </section>
     <section>
<h3><a name="Torque_Turbine_Model_Web_App"></a>Torque Turbine Model Web App</h3>
          
<p>Check out the Turbine Web App from the maven archetype catalog to test a web app with example code. Find the archetype with 
          </p>
<div class="source"><pre class="prettyprint"> 
            // filter archeype catalog by groupid:artefactid = org.apache.turbine:turbine-webapp-5.1
            mvn archetype:generate
          </pre></div> or checkout and build based on Turbine 5.1 trunk:
          
<div class="source"><pre class="prettyprint">
            git clone https://gitbox.apache.org/repos/asf/turbine-archetypes.git
            mvn clean install
          </pre></div>
          If you check out from the trunk, you may have to build other sources as well (any dependeny resource with a SNAPSHOT version).
            
      </section>    
  
  <section>
<h3><a name="NT"></a>NT</h3>
    
<p>
    If you use the BasicModel with the NT implementation, you have a wholly NT based authentication scheme!  The groups map onto NT groups, while the
    users are authenticated against NT as well.  This does require you to ask your users for their NT username and password however, we
    don't have NTLM working as yet.
    </p>
  </section>
</section>



        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2011&#x2013;2021
<a href="https://www.apache.org/">The Apache Software Foundation</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
